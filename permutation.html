<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Permutation Test for Sexual Dimorphism</title>
        
        <!-- d3 library for data visualization and animation -->
        <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>

        <!-- jstat library for probability distributions -->
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jstat@latest/dist/jstat.min.js"></script>
        
        <!-- phyleaux library for phylogenetic objects and functions -->
        <!-- script type="text/javascript" src="https://jembrown.github.io/jembrown.js"></script -->
        <script type="text/javascript" src="jembrown.js"></script>
        
		<style type="text/css">
        	
        	@font-face { font-family: Glober; font-weight: semibold; src: url('Glober-SemiBold.otf'); }
        	        	
        	h1 {
        		font-family: sans-serif;
        		font-size: 36px;
        		font-weight: normal;
        	}
        	        	
        	p {
        		font-family: Glober;
        		font-size: 14px;
        	}
        </style>
    </head>
    <body>
    
		<h1>Permutation Test for Sexual Dimorphism</h1>
	
		<section id="controls">
			<button id="permute"
					style="display: inline-block; text-align: right">Permute
			</button>
		</section>
		<br>
		<section id = "visualization">
			<script>
			
				// TO DO:
				//	 - Add box around observations
				//	 - ADD M_avg and F_avg and diff values 
				//	 - Code for permutation histogram (fixed # of bins)
			
				// Setting up data sets
				var sampleSize = 5;

				var sampleOne = [];
				var labelOne = [];
				
				var meanOne = 10;
				var sdOne = 1;
								
				for (let i = 0; i < sampleSize; i++){
					let newSamp = Math.round(jStat.normal.sample(meanOne,sdOne)*100)/100;
					sampleOne.push(newSamp);
					labelOne.push("M")
				}

				var sampleTwo = [];
				var labelTwo = [];
				
				var meanTwo = 12;
				var sdTwo = 1;
				
				for (let i = 0; i < sampleSize; i++){
					let newSamp = Math.round(jStat.normal.sample(meanTwo,sdTwo)*100)/100;
					sampleTwo.push(newSamp);
					labelTwo.push("F")				
				}				

				var obsDiff = [avg(sampleTwo)-avg(sampleOne)];

				// Arrays to keep track of permutation results
				var perLabels = [];
				var perDiffs = [];

				var sampleLabels = ["M","M","M","M","M","F","F","F","F","F"];

				function runPermutation(){
			
					d3.selectAll("svg").remove();
			
					var svgWidth = 1200;	
					var svgHeight = 1000;

					var perSVG = d3.select("body")		// Create new svg
									.select("#visualization")
									.append("svg")
									.attr("width",svgWidth)
									.attr("height",svgHeight);

					// Cartoon of male population
					perSVG.append("rect")
						  .attr("x",50)
						  .attr("y",10)
						  .attr("width",150)
						  .attr("height",120)
						  .attr("fill","rgb(255,209,0)")
						  .attr("rx",15)
						  .attr("ry",15)

					perSVG.append("text")
						  .attr("x",102)
						  .attr("y",50)
						  .attr("font-family","sans-serif")
						  .attr("font-size","20px")
						  .attr("fill","black")
						  .text("Male")
					perSVG.append("text")
						  .attr("x",103)
						  .attr("y",75)
						  .attr("font-family","sans-serif")
						  .attr("font-size","20px")
						  .attr("fill","black")
						  .text("Trait")
					perSVG.append("text")
						  .attr("x",93)
						  .attr("y",100)
						  .attr("font-family","sans-serif")
						  .attr("font-size","20px")
						  .attr("fill","black")
						  .text("Values")

					// Cartoon of female population
					perSVG.append("rect")
						  .attr("x",225)
						  .attr("y",10)
						  .attr("width",150)
						  .attr("height",120)
						  .attr("fill","rgb(39,116,174)")
						  .attr("rx",15)
						  .attr("ry",15)

					perSVG.append("text")
						  .attr("x",267)
						  .attr("y",50)
						  .attr("font-family","sans-serif")
						  .attr("font-size","20px")
						  .attr("fill","white")
						  .text("Female")
					perSVG.append("text")
						  .attr("x",278)
						  .attr("y",75)
						  .attr("font-family","sans-serif")
						  .attr("font-size","20px")
						  .attr("fill","white")
						  .text("Trait")
					perSVG.append("text")
						  .attr("x",268)
						  .attr("y",100)
						  .attr("font-family","sans-serif")
						  .attr("font-size","20px")
						  .attr("fill","white")
						  .text("Values")

					drawPermutHist(Math.round(svgWidth/2)+150,	// xCoor
									130,						// yCoor
									80,							// h
									svgWidth*0.4,				// w
									perSVG,						// svg
									obsDiff.concat(perDiffs));	// values

					for (let i = 0; i < sampleSize*2; i++){
						perSVG.append("text")
							.attr("x",30+(65*i))
							.attr("y",230)
							.attr("font-family","sans-serif")
							.attr("font-size","16px")
							.attr("fill","black")
							.text(sampleOne.concat(sampleTwo)[i])
						if (i < sampleSize){
							perSVG.append("text")
								.attr("x",30+(65*i)+10)
								.attr("y",210)
								.attr("font-family","sans-serif")
								.attr("font-size","16px")
								.attr("fill","rgb(255,209,0)")
								.text("M")	
						} else {
							perSVG.append("text")
								.attr("x",30+(65*i)+10)
								.attr("y",210)
								.attr("font-family","sans-serif")
								.attr("font-size","16px")
								.attr("fill","rgb(39,116,174)")
								.text("F")	
						} // close if...else
					} // close for loop across samples
			
					perSVG.append("text")
						  .attr("x",30+(65*sampleSize*2)+10)
						  .attr("y",230)
						  .attr("font-family","sans-serif")
						  .attr("font-size","16px")
						  .attr("fill","rgb(255,209,0)")
						  .text("Avg. M = ")
					perSVG.append("text")
						  .attr("x",30+(65*sampleSize*2)+75)
						  .attr("y",230)
						  .attr("font-family","sans-serif")
						  .attr("font-size","16px")
						  .attr("fill","rgb(255,209,0)")
						  .text(Math.round(avg(sampleOne)*10)/10)
						  
					perSVG.append("text")
						  .attr("x",30+(65*sampleSize*2)+115)
						  .attr("y",230)
						  .attr("font-family","sans-serif")
						  .attr("font-size","16px")
						  .attr("fill","rgb(39,116,174)")
						  .text("Avg. F = ")
					perSVG.append("text")
						  .attr("x",30+(65*sampleSize*2)+175)
						  .attr("y",230)
						  .attr("font-family","sans-serif")
						  .attr("font-size","16px")
						  .attr("fill","rgb(39,116,174)")
						  .text(Math.round(avg(sampleTwo)*10)/10)

					perSVG.append("text")
						  .attr("x",30+(65*sampleSize*2)+220)
						  .attr("y",230)
						  .attr("font-family","sans-serif")
						  .attr("font-size","16px")
						  .attr("fill","black")
						  .text("Obs. Diff. = ")
					perSVG.append("text")
						  .attr("x",30+(65*sampleSize*2)+305)
						  .attr("y",230)
						  .attr("font-family","sans-serif")
						  .attr("font-size","16px")
						  .attr("fill","black")
						  .text(Math.round(obsDiff*100)/100)				  


			
				}
			
				runPermutation();
		
				d3.select("#permute")
				  .on("click",function(){
				  	 permuteLabels(perLabels,copy(sampleLabels));
				  	 calcPerDiffs(sampleOne.concat(sampleTwo),perDiffs,perLabels[perLabels.length-1]);
					 runPermutation();
				  });
	
			</script>
 		</section>
    </body>
</html>
